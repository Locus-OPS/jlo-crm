<body>
  <div class="container">
    <div class="row">
      <section class="discussions">
        <form [formGroup]="searchForm" (ngSubmit)="searchData()" style="margin-bottom: -10px">
          <div class="discussion search">
            <div class="searchbar">
              <i class="fa fa-search" aria-hidden="true"></i>
              <input type="text" formControlName="userChatName" placeholder="Search..." />
            </div>
          </div>
        </form>
        <div class="discussion-container">
          <div class="tabs">
            <span class="tab" [class.active]="activeTab === 'Chat'" (click)="setActiveTab('Chat')"> Chats </span>
            <span class="tab" [class.active]="activeTab === 'AllUsers'" (click)="setActiveTab('AllUsers')"> All Users </span>
            <span class="tab" [class.active]="activeTab === 'Group'" (click)="setActiveTab('Group')"> Groups </span>
          </div>

          @if(activeTab === 'Chat'){
          <div>
            <div *ngFor="let chat of chatList" class="discussion" (click)="onSelectChat(chat)">
              @if(chat.messageType === 'private'){
              <div
                class="photo"
                [ngStyle]="getBackgroundStyle(chat.pictureUrl)"
              >
                @if(chat.isOnline && chat.messageType == 'private'){
                <div class="online"></div>
                } @if(!chat.isOnline && chat.messageType == 'private'){
                <div class="offline"></div>
                }
              </div>
              } @if(chat.messageType === 'public'){
              <div
                class="photo"
                [ngStyle]="getStaticBackgroundStyle(chat.pictureUrl)"
              >
                <!-- <div *ngIf="chat.isOnline" class="online"></div> -->
              </div>
              }

              <div class="desc-contact">
                <p class="name">{{ chat.chatName }}</p>
                <p class="message">{{ chat.messageText }}</p>
                <!-- <p class="time">{{ chat.createdAt }}</p> -->
              </div>
            </div>
          </div>
          } @if(activeTab === 'AllUsers'){
          <div>
            <div *ngFor="let user of users" class="discussion" (click)="onSelectUser(user)">
              <div
                class="photo"
                [ngStyle]="getBackgroundStyle(user.pictureUrl)"
              >
                @if(user.isOnline){
                <div class="online"></div>
                } @if(!user.isOnline){
                <div class="offline"></div>
                }
              </div>
              <div class="desc-contact">
                <p class="name">{{ user.userChatName }}</p>
                @if(!user.isOnline && user.lastSeen != null){
                <p class="message">{{ 'last seen : ' + user.lastSeen }}</p>
                }
              </div>
              <!-- <div class="timer">{{ user.time }}</div> -->
            </div>
          </div>
          } @if(activeTab === 'Group'){
          <div>
            <div *ngFor="let chatGroup of chatGroups" class="discussion" (click)="onSelectGroup(chatGroup)">
              <div
                class="photo"
                [ngStyle]="getStaticBackgroundStyle('./assets/img/chatgroup.png')"
              >
                <!-- <div *ngIf="chatGroup.isOnline" class="online"></div> -->
              </div>
              <div class="desc-contact">
                <p class="name">{{ chatGroup.roomName }}</p>
                <p class="message">{{ chatGroup.totalMember + ' Members' }}</p>
              </div>
              <!-- <div class="timer">{{ chatGroup.time }}</div> -->
            </div>
          </div>
          }
        </div>
        @if(activeTab === 'Group'){
        <button class="floating-btn" (click)="openChatGroupModal()"><i class="fa fa-plus" aria-hidden="true"></i> Add</button>
        } @if(activeTab === 'Chat'){
        <button class="floating-btn" (click)="openBroadCastModal()"><i class="fa fa-plus" aria-hidden="true"></i> Broadcast</button>
        }
      </section>

      <section class="chat">
        <div class="header-chat">
          @if(activeTab === 'AllUsers' || messagetype === 'private'){
          <i class="icon fa fa-user-o" aria-hidden="true"></i>
          } @if(activeTab === 'Group' || messagetype === 'public'){
          <i class="icon fa fa-users" aria-hidden="true"></i>
          } @if(activeTab === 'AllUsers'){
          <p class="name">
            {{ this.user == null ? '' : this.user.userChatName }}
          </p>
          } @if(activeTab === 'Chat'){
          <p class="name">{{ this.user == null ? '' : this.user.chatName }}</p>
          } @if(activeTab === 'Group'){
          <p class="name" (click)="alert('Hi')">{{ this.chatGroup == null ? '' : this.chatGroup.roomName }}</p>
          } @if(chatGroup != null){
          <i class="icon clickable fa fa-ellipsis-h iconchat right" (click)="editChatRoom()" aria-hidden="true"></i>
          }
        </div>

        @if(activeTab === 'AllUsers' || messagetype === 'private'){
        <div>
          <div class="messages-chat">
            @if(totalMessages > messages.length && totalMessages != 0){
            <div class="row-loadmore" (click)="loadChatHistory()">
              <div class="load-more-icon"><i id="refresh-icon" class="icon fa fa-refresh"></i></div>
            </div>
            } @if(user != null){
            <div>
              <div *ngFor="let message of messages">
                @if(isUserMatch(message)){
                <div class="message text-only">
                  <div class="response">
                    <p class="text">{{ message.messageText }}</p>
                    <p class="time-response">{{ message.createdAt }}</p>
                  </div>
                </div>
                } @if(!isUserMatch(message)){
                <div class="message">
                  <div
                    class="photo"
                    [ngStyle]="getBackgroundStyle(user.pictureUrl)"
                  >
                    <!-- <div class="online"></div> -->
                  </div>
                  <p class="text">{{ message.messageText }}</p>
                </div>
                } @if(!isUserMatch(message)){
                <div class="time">{{ message.createdAt }}</div>
                }
              </div>
            </div>
            }
          </div>
          @if(user != null){
          <div class="footer-chat">
            <i class="icon fa fa-smile-o clickable" style="font-size: 25pt" aria-hidden="true"></i>
            <input
              type="text"
              class="write-message"
              placeholder="Type your message here"
              [(ngModel)]="newMessage"
              (keydown.enter)="sendPrivateMessage()"
            />
            <i class="icon send fa fa-paper-plane-o clickable" aria-hidden="true" (click)="sendPrivateMessage()"></i>
          </div>
          }
        </div>
        } @if(activeTab === 'Group' || messagetype === 'public'){
        <div>
          <div class="messages-chat">
            @if(totalMessages > messages.length && totalMessages != 0){
            <div class="row-loadmore" (click)="loadChatGroupHistory()">
              <div class="load-more-icon"><i id="refresh-icon" class="icon fa fa-refresh"></i></div>
            </div>
            } @if(chatGroup != null){
            <div>
              <div *ngFor="let message of messages">
                @if(isUserMatchChatRoom(message)){
                <div class="message text-only">
                  <div class="response">
                    <p class="text">{{ message.messageText }}</p>
                    <p class="time-response">{{ message.createdAt }}</p>
                  </div>
                </div>
                } @if(!isUserMatchChatRoom(message)){
                <div class="message">
                  <div
                    class="photo"
                    [ngStyle]="getBackgroundStyle(message.pictureUrl)"
                    [matTooltip]="message.senderName"
                  ></div>
                  <p class="text">{{ message.messageText }}</p>
                </div>
                } @if(!isUserMatchChatRoom(message)){
                <div class="time">{{ message.createdAt }}</div>
                }
              </div>
            </div>
            }
          </div>
          @if(chatGroup != null){
          <div class="footer-chat">
            <i class="icon fa fa-smile-o clickable" style="font-size: 25pt" aria-hidden="true"></i>
            <input
              type="text"
              class="write-message"
              placeholder="Type your message here"
              [(ngModel)]="newMessage"
              (keydown.enter)="sendMessagetoChatRoom()"
            />
            <i class="icon send fa fa-paper-plane-o clickable" aria-hidden="true" (click)="sendMessagetoChatRoom()"></i>
          </div>
          }
        </div>
        }
      </section>
    </div>
  </div>
</body>
