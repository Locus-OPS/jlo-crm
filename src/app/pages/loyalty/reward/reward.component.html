<div class="main-content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header card-header-primary card-header-icon">
            <div class="card-icon">
              <i class="material-icons">assignment</i>
            </div>
            <h4 class="card-title">{{ 'reward.title' | translate }}</h4>
          </div>
          <div class="card-body">
            <form [formGroup]="searchForm" (ngSubmit)="onSearch()" novalidate>
              <div class="row">
                <mat-form-field class="col-md-3">
                  <input matInput [placeholder]="'reward.code' | translate" type="text" formControlName="productCode">
                </mat-form-field>
                <mat-form-field class="col-md-3">
                  <input matInput [placeholder]="'reward.name' | translate" type="text" formControlName="product">
                </mat-form-field>
                <mat-form-field class="col-md-3">
                  <mat-select [placeholder]="'reward.type' | translate"  formControlName="rewardType">
                    <mat-option>--</mat-option>
                    <mat-option *ngFor="let item of rewardTypeList" [value]="item.codeId">{{ item.codeName }}</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field class="col-md-3">
                  <mat-select [placeholder]="'reward.campaign' | translate"  formControlName="campaignId">
                    <mat-option>--</mat-option>
                    <mat-option *ngFor="let item of allCampaignList" [value]="item.codeId">{{ item.codeName }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div align="end">
                <button mat-raised-button type="button" class="btn btn-fill btn-rose" type="submit">{{ 'button.search' | translate }}</button>
                <button *ngIf="CAN_WRITE() && !created" mat-raised-button type="button" class="btn btn-fill btn-primary" (click)="create()">{{ 'button.create' | translate }}</button>
                <button *ngIf="CAN_WRITE() && created" mat-raised-button type="button" class="btn btn-fill btn-default" (click)="cancel()">{{ 'button.cancel' | translate }}</button>
                <button mat-raised-button type="button" class="btn btn-fill btn-default" type="reset" (click)="clear()">{{ 'button.clear' | translate }}</button>
              </div>
            </form>
            <div class="toolbar">
              <!--        Here you can write extra buttons/actions for the toolbar              -->
            </div>
            <div class="material-datatables">
              <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 table-responsive"
              (matSortChange)="tableControl.onSort($event)" matSort matSortActive="product" matSortDirection="asc"
                matSortDisableClear>
                <ng-container matColumnDef="action">
                  <th mat-header-cell *matHeaderCellDef> Action </th>
                  <td mat-cell *matCellDef="let element">
                    <button *ngIf="CAN_WRITE()" class="btn btn-danger btn-round btn-fab mat-raised-button" (click)="onDelete(element); $event.stopPropagation();">
                      <span class="mat-button-wrapper">
                        <i class="material-icons">remove</i>
                      </span>
                    </button>
                  </td>
                </ng-container>
                <ng-container matColumnDef="productCode" sticky>
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ 'reward.code' | translate }} </th>
                  <td mat-cell *matCellDef="let element"> {{element.productCode}} </td>
                </ng-container>
                <ng-container matColumnDef="product">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ 'reward.name' | translate }} </th>
                  <td mat-cell *matCellDef="let element"> {{element.product}} </td>
                </ng-container>
                <ng-container matColumnDef="campaign">
                  <th mat-header-cell *matHeaderCellDef> {{ 'reward.campaign' | translate }} </th>
                  <td mat-cell *matCellDef="let element"> {{element.campaign}} </td>
                </ng-container>
                <ng-container matColumnDef="rewardType">
                    <th mat-header-cell *matHeaderCellDef> {{ 'reward.type' | translate }} </th>
                    <td mat-cell *matCellDef="let element"> {{element.rewardType}} </td>
                  </ng-container>
                <ng-container matColumnDef="category">
                    <th mat-header-cell *matHeaderCellDef> {{ 'reward.category' | translate }} </th>
                    <td mat-cell *matCellDef="let element"> {{element.rewardCategory}} </td>
                  </ng-container>
                <ng-container matColumnDef="subCategory">
                  <th mat-header-cell *matHeaderCellDef> {{ 'reward.subCategory' | translate }} </th>
                  <td mat-cell *matCellDef="let element"> {{element.rewardSubCategory}} </td>
                </ng-container>
                <ng-container matColumnDef="startDate">
                  <th mat-header-cell *matHeaderCellDef> {{ 'reward.startDate' | translate }} </th>
                  <td mat-cell *matCellDef="let element"> {{element.startDate}} </td>
                </ng-container>
                <ng-container matColumnDef="endDate">
                  <th mat-header-cell *matHeaderCellDef> {{ 'reward.endDate' | translate }} </th>
                  <td mat-cell *matCellDef="let element"> {{element.endDate}} </td>
                </ng-container>
                <ng-container matColumnDef="activeFlag">
                  <th mat-header-cell *matHeaderCellDef class="text-center"> {{ 'reward.active' | translate }} </th>
                  <td mat-cell *matCellDef="let element" class="text-center">
                    <mat-icon matSuffix *ngIf="element.rewardActiveFlag === 'Y'">done</mat-icon>
                  </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onSelectRow(row)"
                  [ngClass]="{ 'selected-row': selectedRow == row }"></tr>
              </table>
              <mat-paginator class="mat-paginator-sticky" (page)="tableControl.onPage($event)" [length]="tableControl.total"
                [pageIndex]="tableControl.pageNo" [pageSize]="tableControl.pageSize" [pageSizeOptions]="tableControl.pageSizeOptions" showFirstLastButtons>
              </mat-paginator>
            </div>
          </div>
          <!-- end content-->
        </div>
        <!--  end card  -->
        <div class="card" *ngIf="selectedRow">
            <div class="card-header card-header-icon card-header-rose">
              <div class="card-icon">
                <i class="material-icons">perm_identity</i>
              </div>
              <h4 class="card-title">{{ 'reward.detailTitle' | translate }} </h4>
            </div>
            <div class="card-body">
              <form #createFormDirective="ngForm" [formGroup]="createForm" (ngSubmit)="onSave($event)">
                <input type="hidden" formControlName="productId" />
                <input type="hidden" formControlName="previousProductCode" />
                <div class="row">
                  <div class="col-md-2">
                    <div class="card-profile">
                      <mat-progress-bar mode="determinate" *ngIf="uploadProgress > 0" [value]="uploadProgress"></mat-progress-bar>
                      <div class="card-avatar">
                        <a *ngIf="CAN_WRITE()">
                          <img class="profile-img" (click)="fileUpload.click()"
                            [src]="imageSrc ? imageSrc : (selectedRow.productImgPath ? rewardApi.getRewardImagePath(selectedRow.productImgPath) : './assets/img/profile_image_not_found.png')" />
                        </a>
                        <a *ngIf="!CAN_WRITE()">
                          <img class="profile-img"
                            [src]="imageSrc ? imageSrc : (selectedRow.productImgPath ? rewardApi.getRewardImagePath(selectedRow.productImgPath) : './assets/img/profile_image_not_found.png')" />
                        </a>
                      </div>
                      <input type="file" hidden #fileUpload (change)="selectFile($event)"><br />
                      <div *ngIf="selectedRow.productId">
                        <a *ngIf="imageSrc" class="btn btn-info btn-round" (click)="upload()">{{ 'button.upload' | translate }}</a>&nbsp;
                        <!-- <a class="btn btn-error btn-round">Remove</a> -->
                      </div>
                    </div>
                  </div>
                  <div class="col-md-10">
                    <div class="row">
                      <mat-form-field class="col-md-3">
                        <mat-select [placeholder]="'reward.program' | translate"  formControlName="programId">
                          <mat-option>--</mat-option>
                          <mat-option *ngFor="let item of programList" [value]="item.codeId">{{ item.codeName }}</mat-option>
                        </mat-select>
                        <mat-error *ngIf="createForm.controls['programId'].hasError('required')">
                          {{ 'error.required' | translate }}
                        </mat-error>
                      </mat-form-field>
                        <mat-form-field class="col-md-3">
                          <input matInput [placeholder]="'reward.code' | translate" type="text" formControlName="productCode" maxlength="50" />
                          <mat-error *ngIf="createForm.controls['productCode'].hasError('required')">
                            {{ 'error.required' | translate }}
                          </mat-error>
                      </mat-form-field>
                        <mat-form-field class="col-md-3">
                          <input matInput [placeholder]="'reward.name' | translate" type="text" formControlName="product" maxlength="255" />
                          <mat-error *ngIf="createForm.controls['product'].hasError('required')">
                            {{ 'error.required' | translate }}
                          </mat-error>
                      </mat-form-field>
                      <mat-form-field class="col-md-3">
                        <mat-select [placeholder]="'reward.status' | translate"  formControlName="rewardActiveFlag">
                          <mat-option *ngFor="let item of rewardActiveFlagList" [value]="item.codeId">{{ item.codeName }}</mat-option>
                        </mat-select>
                        <mat-error *ngIf="createForm.controls['rewardActiveFlag'].hasError('required')">
                          {{ 'error.required' | translate }}
                        </mat-error>
                      </mat-form-field>
                    </div>
                    <div class="row">
                      <mat-form-field class="col-md-3">
                        <input matInput [matDatepicker]="startDateRef" (dateChange)="onStartDateChange($event)"
                        [placeholder]="'reward.startDate' | translate" formControlName="startDate" >
                        <mat-datepicker-toggle matSuffix [for]="startDateRef"></mat-datepicker-toggle>
                        <mat-datepicker #startDateRef></mat-datepicker>
                        <mat-error *ngIf="createForm.controls['startDate'].hasError('required')">
                          {{ 'error.required' | translate }}
                        </mat-error>
                      </mat-form-field>
                      <mat-form-field class="col-md-3">
                        <input matInput [matDatepicker]="endDateRef" (dateChange)="onEndDateChange($event)"
                        [placeholder]="'reward.endDate' | translate" formControlName ="endDate">
                        <mat-datepicker-toggle matSuffix [for]="endDateRef"></mat-datepicker-toggle>
                        <mat-datepicker #endDateRef ></mat-datepicker>
                        <mat-error *ngIf="createForm.controls['endDate'].hasError('required')">
                          {{ 'error.required' | translate }}
                        </mat-error>
                      </mat-form-field>
                      <mat-form-field class="col-md-3">
                        <mat-select [placeholder]="'reward.type' | translate"  formControlName="rewardTypeId">
                          <mat-option *ngFor="let item of rewardTypeList" [value]="item.codeId">{{ item.codeName }}</mat-option>
                        </mat-select>
                        <mat-error *ngIf="createForm.controls['rewardTypeId'].hasError('required')">
                          {{ 'error.required' | translate }}
                        </mat-error>
                      </mat-form-field>
                      <mat-form-field class="col-md-3">
                        <mat-select [placeholder]="'reward.campaign' | translate"  formControlName="campaignId">
                          <mat-option *ngFor="let item of activeCampaignList" [value]="item.codeId">{{ item.codeName }}</mat-option>
                        </mat-select>
                        <mat-error *ngIf="createForm.controls['campaignId'].hasError('required')">
                          {{ 'error.required' | translate }}
                        </mat-error>
                      </mat-form-field>
                    </div>
                    <div class="row">
                      <mat-form-field class="col-md-3">
                        <mat-select placeholder="Reward Category"  formControlName="rewardCategoryId" (valueChange)="onChangeParentCategory($event)">
                          <mat-option *ngFor="let item of rewardCategoryList" [value]="item.codeId">{{ item.codeName }}</mat-option>
                        </mat-select>
                        <mat-error *ngIf="createForm.controls['rewardCategoryId'].hasError('required')">
                          {{ 'error.required' | translate }}
                        </mat-error>
                      </mat-form-field>
                      <mat-form-field class="col-md-3">
                        <mat-select [placeholder]="'reward.subCategory' | translate"  formControlName="rewardSubCategoryId">
                          <mat-option *ngFor="let item of rewardSubCategoryList" [value]="item.codeId">{{ item.codeName }}</mat-option>
                        </mat-select>
                        <mat-error *ngIf="createForm.controls['rewardSubCategoryId'].hasError('required')">
                          {{ 'error.required' | translate }}
                        </mat-error>
                      </mat-form-field>
                      <mat-form-field class="col-md-3">
                          <input matInput [placeholder]="'reward.price' | translate" type="number" formControlName="rewardPrice" min="0" />
                          <mat-error *ngIf="createForm.controls['rewardPrice'].hasError('required')">
                            {{ 'error.required' | translate }}
                          </mat-error>
                          <mat-error *ngIf="createForm.controls['rewardPrice'].hasError('min')">
                            {{ 'error.min' | translate }}
                          </mat-error>
                      </mat-form-field>
                        <mat-form-field class="col-md-2">
                          <input matInput [placeholder]="'reward.unitPerPerson' | translate" type="number" formControlName="rewardUnitPerson" min="0" />
                          <mat-error *ngIf="createForm.controls['rewardUnitPerson'].hasError('required')">
                            {{ 'error.required' | translate }}
                          </mat-error>
                          <mat-error *ngIf="createForm.controls['rewardUnitPerson'].hasError('min')">
                            {{ 'error.min' | translate }}
                          </mat-error>
                      </mat-form-field>
                      <mat-form-field class="col-md-1">
                          <input matInput [placeholder]="'reward.tax' | translate" type="number" formControlName="rewardTax" min="0" max="100" />
                          <mat-error *ngIf="createForm.controls['rewardTax'].hasError('required')">
                            {{ 'error.required' | translate }}
                          </mat-error>
                          <mat-error *ngIf="createForm.controls['rewardTax'].hasError('min')">
                            {{ 'error.min' | translate }}
                          </mat-error>
                          <mat-error *ngIf="createForm.controls['rewardTax'].hasError('max')">
                            {{ 'error.max' | translate }}
                          </mat-error>
                      </mat-form-field>
                    </div>
                    <div class="row">
                      <mat-form-field class="col-md-6">
                        <textarea matInput matTextareaAutosize matAutosizeMinRows=5 matAutosizeMaxRows=20
                        [placeholder]="'reward.description' | translate" type="text" formControlName="productDetail">
                        </textarea>
                      </mat-form-field>
                      <div class="col-md-6">
                        <div class="row">
                          <div class="col-md-4">
                            <mat-checkbox formControlName="rewardChannelWebPortalFlag">Web Portal</mat-checkbox>
                          </div>
                          <div class="col-md-4">
                            <mat-checkbox formControlName="rewardChannelLineFlag">LINE</mat-checkbox>
                          </div>
                          <div class="col-md-4">
                            <mat-checkbox formControlName="rewardChannelMobileFlag">Mobile</mat-checkbox>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-md-4">
                            <mat-checkbox formControlName="rewardChannelKiosFlag">Kiosk</mat-checkbox>
                          </div>
                          <div class="col-md-4">
                            <mat-checkbox formControlName="isGiftCardFlag">Gift Card</mat-checkbox>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <app-created-by
                    [createdBy]="createForm.controls['createdBy'].value"
                    [createdDate]="createForm.controls['createdDate'].value"
                    [updatedBy]="createForm.controls['updatedBy'].value"
                    [updatedDate]="createForm.controls['updatedDate'].value">
                </app-created-by>
                <button *ngIf="!created" mat-raised-button type="button" class="btn btn-info pull-left"
                (click)="showMore()">{{ 'button.showMoreTab' | translate }}</button>
                <button *ngIf="CAN_WRITE()" mat-raised-button type="submit" class="btn btn-rose pull-right">{{ 'button.save' | translate }}</button>
                <div class="clearfix"></div>
              </form>
            </div>
        </div>
        <!-- end of selected row -->
        <div class="card" *ngIf="isShowMoreTab">
          <div class="card-header card-header-icon card-header-success">
            <div class="card-icon">
              <i class="material-icons">description</i>
            </div>
            <h4 class="card-title">{{ 'reward.additionalInfo' | translate }}</h4>
          </div>
          <div class="card-body" style="min-height: 400px;">
            <mat-tab-group>
              <!-- <mat-tab label="Change Log"> Content 1 </mat-tab> -->
              <mat-tab [label]="'reward.onHand' | translate">
                <app-reward-on-hand></app-reward-on-hand>
              </mat-tab>
              <mat-tab [label]="'reward.redeemMethod' | translate">
                <app-redeem-method></app-redeem-method>
              </mat-tab>
              <mat-tab [label]="'reward.redeemTrans' | translate">
                <app-redeem-transaction></app-redeem-transaction>
              </mat-tab>
              <!-- <mat-tab label="Action Log"> Content 3 </mat-tab> -->
            </mat-tab-group>
          </div>
        </div>
      </div>
      <!-- end col-md-12 -->
    </div>
    <!-- end row -->
  </div>
</div>

